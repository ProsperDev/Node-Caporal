<p align="center">
    <img src="https://github.com/mattallty/Caporal.js/blob/6a8bd68b454ff6327df310d290ee453e0efc087b/assets/caporal.svg?raw=true" width="437" height="127">
</p>

# Caporal

> A full-featured framework for building command line applications (cli) with node.js,
> including help generation, colored output, verbosity control, custom logger, coercion
> and casting, typos suggestions, and auto-complete for bash/zsh/fish.

## Install

Simply add Caporal as a dependency:

```bash
$ npm install caporal

# Or if you are using yarn (https://yarnpkg.com/lang/en/)
$ yarn add caporal
```

## Documentation

[**Checkout our website https://caporal.io for docs.**](https://caporal.io)

## Contributors ✨

Thanks goes to these wonderful people for contributing to this project:

<!-- @include-start CONTRIBUTORS.md -->

| <a href="https://github.com/mattallty"><b>Matthias ETIENNE</b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/178616?v=4"></a> |          <a href="https://github.com/kinok"><b>@kinok</b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/3816424?v=4"></a>          | <a href="https://github.com/thecodejunkie"><b>Andreas Håkansson</b><br><img width="60" height="60" border="0" src="https://avatars0.githubusercontent.com/u/50543?v=4"></a>  | <a href="https://github.com/fabiospampinato"><b>Fabio Spampinato</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/1812093?v=4"></a> |    <a href="https://github.com/Szpadel"><b>@Szpadel</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/1857251?v=4"></a>    |
| :---------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|    <a href="https://github.com/searsaw"><b>Alex Sears</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/3712883?v=4"></a>     |    <a href="https://github.com/bbusschots"><b>Bart Busscots</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/5204055?v=4"></a>    | <a href="https://github.com/Blackbaud-BobbyEarl"><b>Bobby Earl</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/4612419?v=4"></a> |   <a href="https://github.com/bwinterton"><b>Brayden Winterton</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/5790659?v=4"></a>   |  <a href="https://github.com/DanielRuf"><b>Daniel Ruf</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/827205?v=4"></a>   |
|  <a href="https://github.com/drewsonne"><b>Drew J. Sonne</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/233054?v=4"></a>   |    <a href="https://github.com/fgarcia"><b>Francisco Javier</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/253157?v=4"></a>     |         <a href="https://github.com/gcox"><b>George Cox</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/251512?v=4"></a>         |    <a href="https://github.com/ihorskyi"><b>Ihor Halchevskyi</b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/6171149?v=4"></a>     |       <a href="https://github.com/ilyar"><b>Ilyar</b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/761285?v=4"></a>       |
| <a href="https://github.com/jorgebucaran"><b>Jorge Bucaran</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/56996?v=4"></a>  |     <a href="https://github.com/budnix"><b>Krzysztof Budnik</b><br><img width="60" height="60" border="0" src="https://avatars0.githubusercontent.com/u/571316?v=4"></a>     | <a href="https://github.com/bertho-zero"><b>Kévin Berthommier</b><br><img width="60" height="60" border="0" src="https://avatars0.githubusercontent.com/u/8525267?v=4"></a>  |     <a href="https://github.com/kobleistvan"><b>Köble István</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/6638917?v=4"></a>     | <a href="https://github.com/limichange"><b>limichange</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/1947344?v=4"></a>  |
| <a href="https://github.com/khaosdoctor"><b>Lucas Santos</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/3200560?v=4"></a>  |    <a href="https://github.com/lmammino"><b>Luciano Mammino</b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/205629?v=4"></a>     |  <a href="https://github.com/masnagam"><b>Masayuki Nagamachi</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/2015132?v=4"></a>   |       <a href="https://github.com/mfilenko"><b>Max Filenko</b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/199476?v=4"></a>        |   <a href="https://github.com/mycaule"><b>Michel Hua</b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/6161385?v=4"></a>   |
|    <a href="https://github.com/pra85"><b>Prayag Verma </b><br><img width="60" height="60" border="0" src="https://avatars2.githubusercontent.com/u/829526?v=4"></a>     | <a href="https://github.com/robertrossmann"><b>Robert Rossmann</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/3058150?v=4"></a> | <a href="https://github.com/romellogoodman"><b>Romello Goodman</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/6355760?v=4"></a> |       <a href="https://github.com/StinsonZhao"><b>Stinson</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/6703905?v=4"></a>        | <a href="https://github.com/TiagoDanin"><b>Tiago Danin</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/5731176?v=4"></a> |
|          <a href="https://github.com/enko"><b>Tim</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/19407?v=4"></a>           |      <a href="https://github.com/vlaraort"><b>Víctor Lara</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/2410951?v=4"></a>      |      <a href="https://github.com/YOU54F"><b>Yousaf Nabi</b><br><img width="60" height="60" border="0" src="https://avatars3.githubusercontent.com/u/19932401?v=4"></a>       |           <a href="https://github.com/cazgp"><b>@cazgp</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/658873?v=4"></a>            |  <a href="https://github.com/dwyschka"><b>@dwyschka</b><br><img width="60" height="60" border="0" src="https://avatars1.githubusercontent.com/u/25348338?v=4"></a>   |

<!-- @include-end -->

<<<<<<< HEAD

<p align="center">
 <img src="https://github.com/mattallty/Caporal.js/raw/master/assets/suggest.png" wdith="600">
</p>

## Shell auto-completion

Caporal comes with an auto-completion feature out of the box for `bash`, `zsh`, and `fish`,
thanks to [tabtab](https://github.com/mklabs/node-tabtab).

For this feature to work, you will have to:

- Put your cli app in your `$PATH` (this is the case if your app is installed globally using `npm install -g <myapp>`)
- Setup auto-completion for your shell, like bellow.

#### If you are using bash

```bash
# For bash
source <(myapp completion bash)

# or add it to your .bashrc to make it persist
echo "source <(myapp completion bash)" >> ~/.bashrc \
&& source ~/.bashrc
```

#### If you are using zsh

```bash
# For zsh
source <(myapp completion zsh)

# or add it to your .zshrc to make it persist
echo "source <(myapp completion zsh)" >> ~/.zshrc \
&& source ~/.zshrc
```

#### If you are using fish

```bash
# For fish
source <(myapp completion fish)

# or add it to your config.fish to make it persist
echo "source <(myapp completion fish)" >> ~/.config/fish/config.fish \
&& source ~/.config/fish/config.fish
```

### Basic auto-completion

By default, it will autocomplete _commands_ and _option names_.
Also, _options_ having an _Array validator_ will be autocompleted.

### Auto-completion setup example

```javascript
#!/usr/bin/env node

const prog = require("caporal")

prog
  .version("1.0.0")
  // the "order" command
  .command("order", "Order a pizza")
  .alias("give-it-to-me")
  // <kind> will be auto-magicaly autocompleted by providing the user with 3 choices
  .argument("<kind>", "Kind of pizza", ["margherita", "hawaiian", "fredo"])
  .argument("<from-store>", "Which store to order from")
  // enable auto-completion for <from-store> argument using a sync function returning an array
  .complete(function () {
    return ["store-1", "store-2", "store-3", "store-4", "store-5"]
  })

  .argument("<account>", "Which account id to use")
  // enable auto-completion for <account> argument using a Promise
  .complete(function () {
    return Promise.resolve(["account-1", "account-2"])
  })

  .option("-n, --number <num>", "Number of pizza", prog.INT, 1)
  .option("-d, --discount <amount>", "Discount offer", prog.FLOAT)
  .option("-p, --pay-by <mean>", "Pay by option")
  // enable auto-completion for -p | --pay-by option using a Promise
  .complete(function () {
    return Promise.resolve(["cash", "credit-card"])
  })

  // -e | --extra will be auto-magicaly autocompleted by providing the user with 3 choices
  .option("-e, --extra <ingredients>", "Add extra ingredients", [
    "pepperoni",
    "onion",
    "cheese",
  ])
  .action(function (args, options, logger) {
    logger.info("Command 'order' called with:")
    logger.info("arguments: %j", args)
    logger.info("options: %j", options)
  })

  // the "return" command
  .command("return", "Return an order")
  .argument("<order-id>", "Order id")
  // enable auto-completion for <order-id> argument using a Promise
  .complete(function () {
    return Promise.resolve(["#82792", "#71727", "#526Z52"])
  })
  .argument("<to-store>", "Store id")
  .option("--ask-change <other-kind-pizza>", "Ask for other kind of pizza")
  // enable auto-completion for --ask-change option using a Promise
  .complete(function () {
    return Promise.resolve(["margherita", "hawaiian", "fredo"])
  })
  .option("--say-something <something>", "Say something to the manager")
  .action(function (args, options, logger) {
    logger.info("Command 'return' called with:")
    logger.info("arguments: %j", args)
    logger.info("options: %j", options)
  })

prog.parse(process.argv)
```

## API

#### `require('caporal')`

Returns a `Program` instance.

### Program API

#### `.version(version) : Program`

Set the version of your program. You may want to use your `package.json` version to fill it:

```javascript
const myProgVersion = require("./package.json").version
const prog = require("caporal")
prog.version(myProgVersion)
// [...]

prog.parse(process.argv)
```

Your program will then automaticaly handle `-V` and `--version` options:

    matt@mb:~$ ./my-program --version
    1.0.0

#### `.help(text, options?) : Program`

Add a program-level help section.

By default the optional `options` parameter is:

```js
{
    indent: true, // If `true` the text will be automatically indented
    name: "MORE INFO" // The name of the section
}
```

#### `.command(name, description) -> Command`

Set up a new command with name and description. Multiple commands can be added to one program.
Returns a {Command}.

```javascript
const prog = require("caporal")
prog
  .version("1.0.0")
  // one command
  .command("walk", "Make the player walk")
  .action((args, options, logger) => {
    logger.log("I'm walking !")
  }) // you must attach an action for your command
  // a second command
  .command("run", "Make the player run")
  .action((args, options, logger) => {
    logger.log("I'm running !")
  })
  // a command may have multiple words
  .command("cook pizza", "Make the player cook a pizza")
  .argument("<kind>", "Kind of pizza")
  .action((args, options, logger) => {
    logger.log("I'm cooking a pizza !")
  })
// [...]

prog.parse(process.argv)
```

#### `.logger([logger]) -> Program | winston`

Get or set the logger instance. Without argument, it returns the logger instance (_winston_ by default).
With the _logger_ argument, it sets a new logger.

### Command API

#### `.argument(synopsis, description, [validator, [defaultValue]]) -> Command`

Add an argument to the command. Can be called multiple times to add several arguments.

- **synopsis** (_String_): something like `<my-required-arg>` or `[my-optional-arg]`
- **description** (_String_): argument description
- **validator** (_Caporal Flag | Function | Array | RegExp_): optional validator, see [Coercion and casting ](#coercion-and-casting-using-validators)
- **defaultValue** (\*): optional default value

#### `.option(synopsis, description, [validator, [defaultValue, [required]]) -> Command`

Add an option to the command. Can be called multiple times to add several options.

- **synopsis** (_String_): You can pass short or long notation here, or both. See examples.
- **description** (_String_): option description
- **validator** (_Caporal Flag | Function | Array | RegExp_): optional validator, see [Coercion and casting ](#coercion-and-casting-using-validators)
- **defaultValue** (\*): optional default value
- **required** (_Bool_): Is the option itself required ? Default to `false`

#### `.help(text, options?) -> Command`

Add a command-level help section.

By default the optional `options` parameter is:

```js
{
    indent: true, // If `true` the text will be automatically indented
    name: "" // The name of the section, by default this line won't be displayed
}
```

#### `.action(action) -> Command`

Define the action, e.g a _Function_, for the current command.

The _action_ callback will be called with 3 arguments:

- _args_ (Object): Passed arguments
- _options_ (Object): Passed options
- _logger_ (winston): Winston logger instance

```javascript
// sync action
const prog = require("caporal")
prog
  .version("1.0.0")
  .command("walk", "Make the player walk")
  .action((args, options, logger) => {
    logger.log("I'm walking !")
  })
```

You can make your actions async by using Promises:

```javascript
// async action
const prog = require("caporal")
prog
  .version("1.0.0")
  .command("walk", "Make the player walk")
  .action((args, options, logger) => {
    return new Promise(/* ... */)
  })
```

#### `.alias(alias) -> Command`

Define an alias for the current command. A command can only have one alias.

```javascript
const prog = require("caporal")
prog
  .version("1.0.0")
  // one command
  .command("walk", "Make the player walk")
  .alias("w")
  .action((args, options, logger) => {
    logger.log("I'm walking !")
  })

prog.parse(process.argv)

// ./myapp w
// same as
// ./myapp walk
```

#### `.complete(completer) -> Command`

Define an auto-completion handler for the latest argument or option added to the command.

- **completer** (_Function_): The completer function has to return either an `Array` or a `Promise` which resolves to an `Array`.

#### `.visible(visibility?) -> Boolean | Command`

Get or set the visibility value of this command. By default it's `true`, if you set it to `false` it will be omitted from the help message.

```javascript
const prog = require("caporal")
prog
  .version("1.0.0")
  // one command
  .command("walk", "Make the player walk")
  .visible(false)

prog.parse(process.argv)
```

## Credits

Caporal is strongly inspired by [commander.js](https://github.com/tj/commander.js) and [Symfony Console](http://symfony.com/doc/current/components/console.html).
Caporal makes use of the following npm packages:

- [colorette](https://www.npmjs.com/package/colorette) for colors
- [cli-table3](https://www.npmjs.com/package/cli-table3) for cli tables
- [fast-levenshtein](https://www.npmjs.com/package/fast-levenshtein) for suggestions
- [tabtab](https://www.npmjs.com/package/tabtab) for auto-completion
- [minimist](https://www.npmjs.com/package/minimist) for argument parsing
- [prettyjson](https://www.npmjs.com/package/prettyjson) to output json
- # [winston](https://www.npmjs.com/package/winston) for logging

## License

<!-- @include-start LICENSE -->

MIT License

> > > > > > > feat: Caporal v2

Copyright (c) 2017-present Matthias ETIENNE

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

<!-- @include-end -->
